sql_result = [{"pid":2845,"device_id":"myfiwarestory","pct_cpu":0,"pct_mem":0.4,"server":"fiware01","timestamp":"2024-03-27T14:01:07.000Z"},{"pid":25619,"device_id":"8a0ad0ef-1827-42a4-ae42-685a478e6dad","pct_cpu":0,"pct_mem":1.3,"server":"wolfsburg-compute-01","timestamp":"2024-06-06T07:33:02.000Z"},{"pid":24268,"device_id":"2a013d80-7139-479c-bd8b-56eb5075fe86","pct_cpu":0,"pct_mem":2.2,"server":"wolfsburg-compute-01","timestamp":"2024-06-06T07:33:02.000Z"},{"pid":18524,"device_id":"2de30a97-ee9d-41e3-b925-24999f7b7962","pct_cpu":0,"pct_mem":2.6,"server":"wolfsburg-compute-01","timestamp":"2024-06-06T07:33:02.000Z"},{"pid":22276,"device_id":"b683c200-63cd-43ec-ae54-94d6950cac89","pct_cpu":0,"pct_mem":2.6,"server":"wolfsburg-compute-01","timestamp":"2024-06-06T07:33:02.000Z"},{"pid":25276,"device_id":"5c0ba023-3bda-4660-bb8e-7139e0e1ab81","pct_cpu":0,"pct_mem":3.4,"server":"wolfsburg-compute-01","timestamp":"2024-06-06T07:33:02.000Z"},{"pid":26308,"device_id":"61eab3ac-cae1-4f52-9fc1-842080854991","pct_cpu":0,"pct_mem":4.6,"server":"wolfsburg-compute-01","timestamp":"2024-06-06T07:33:02.000Z"},{"pid":24957,"device_id":"0f6cfe35-281c-4eb0-a9ec-cfe19caf81ab","pct_cpu":0,"pct_mem":5.1,"server":"wolfsburg-compute-01","timestamp":"2024-06-06T07:33:02.000Z"},{"pid":2416,"device_id":"tst.fiware.org","pct_cpu":0,"pct_mem":10.2,"server":"fiware01","timestamp":"2024-06-06T07:33:23.000Z"},{"pid":2992,"device_id":"battery-pass","pct_cpu":6.7,"pct_mem":2.8,"server":"fiware01","timestamp":"2024-06-06T07:33:23.000Z"},{"pid":17271,"device_id":"54725d35-17d5-42ed-a299-d58f000cb577","pct_cpu":6.7,"pct_mem":5.1,"server":"wolfsburg-compute-01","timestamp":"2024-06-06T07:33:02.000Z"},{"pid":2342,"device_id":"keystone.fiwarelab","pct_cpu":6.7,"pct_mem":5.3,"server":"fiware01","timestamp":"2024-06-06T07:33:23.000Z"},{"pid":49290,"device_id":"prometheus.fiware.org","pct_cpu":6.7,"pct_mem":10.2,"server":"fiware01","timestamp":"2024-06-06T07:33:23.000Z"},{"pid":30948,"device_id":"aabb2d79-479a-451f-b587-4839846b67d2","pct_cpu":13.3,"pct_mem":2.6,"server":"wolfsburg-compute-01","timestamp":"2024-06-06T07:33:02.000Z"},{"pid":2693,"device_id":"jenkins","pct_cpu":13.3,"pct_mem":3.6,"server":"fiware01","timestamp":"2024-06-06T07:33:23.000Z"},{"pid":2617,"device_id":"admtools_202209","pct_cpu":20,"pct_mem":5.1,"server":"fiware01","timestamp":"2024-06-06T07:33:23.000Z"},{"pid":24394,"device_id":"web-servers-nginx","pct_cpu":20,"pct_mem":7.7,"server":"fiware01","timestamp":"2024-06-06T07:33:23.000Z"},{"pid":46435,"device_id":"forge","pct_cpu":113.3,"pct_mem":5.1,"server":"fiware01","timestamp":"2024-06-06T07:33:23.000Z"},{"pid":45784,"device_id":"1b114412-85ce-4f3b-af6f-3ee388e8de27","pct_cpu":126.7,"pct_mem":10.2,"server":"wolfsburg-compute-01","timestamp":"2024-06-06T07:33:02.000Z"},{"pid":28560,"device_id":"0b8b3589-abf0-4134-ae20-83b89e511ea3","pct_cpu":233.3,"pct_mem":10.2,"server":"wolfsburg-compute-01","timestamp":"2024-06-06T07:33:02.000Z"},{"pid":8109,"device_id":"1a7fcd2f-3529-4c0d-8e88-32cd2d71baa0","pct_cpu":406.7,"pct_mem":5.1,"server":"wolfsburg-compute-01","timestamp":"2024-06-06T07:33:02.000Z"},{"pid":16437,"device_id":"2f2d68af-7101-459c-83ca-3914cf328c8f","pct_cpu":413.3,"pct_mem":4.7,"server":"wolfsburg-compute-01","timestamp":"2024-06-06T07:33:02.000Z"}]
entities = {"1b114412-85ce-4f3b-af6f-3ee388e8de27":{"id":"1b114412-85ce-4f3b-af6f-3ee388e8de27","apikey":"4jggokgpepnvsb2uv4s40d59ov","type":"demosql","name":"urn:ngsi-ld:demosql:1b114412-85ce-4f3b-af6f-3ee388e8de27","service":"openiot","subservice":"/","active":[{"object_id":"device_id","type":"Property","name":"vm_name"},{"object_id":"pid","name":"pid","type":"Property"},{"object_id":"pct_cpu","name":"pct_cpu","type":"Property"},{"object_id":"server","name":"server","type":"Property"},{"object_id":"timestamp","name":"timestamp","type":"timestamp"}],"transport":"mysql","internalId":null}}


entities_keys = Object.keys(entities);
    n_entities = entities_keys.length;
    for  (var i=0; i < n_entities; i++) {
        o = sql_result.find(o => o.device_id === entities_keys[i]);
        if (o) {
            iotAgentLib.update(entities_keys[i], entities_keys[i].device.type,
                '', [o], o, function (error) {
                    if (error) {
                        console.log('Something went wrong!!!');
                        console.log(error);
                    } else {
                        console.log(`Received message:`);
                        console.log(lastMessages[subscriberName]);
                    }
                });
        }
    }
   console.log('update_cb_data');
